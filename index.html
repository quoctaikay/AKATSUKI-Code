<html lang="vi"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>AKATSUKI IPA TEAM</title>
<meta name="color-scheme" content="dark">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<link rel="preload" as="image" href="https://i.postimg.cc/XvT3fFHQ/85-C54337-9753-4-BFB-BF71-57-E7527-F4775.png">
<style>
  :root{
    --bg1:#040a08; --bg2:#030806;
    --panel:#0a1410; --panel2:#0c1914;
    --ink:#eafff3; --muted:#bfe9d2;
    --g1:#00ff88; --g2:#00d06a; --g3:#00b45a;
    --stroke:rgba(0,255,136,.22);
    --glass1:rgba(0,255,136,.08); --glass2:rgba(255,255,255,.02);
    --shadow:0 18px 50px rgba(0,0,0,.6);
    --rad:24px;
    --warn:#ffd24d; --err:#ff6b6b; --ok:#00ffa2;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{
    margin:0; color:var(--ink);
    font:15px/1.6 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial;
    background:
      radial-gradient(60vw 40vh at 20% -10%, rgba(0,255,136,.18), transparent 60%),
      radial-gradient(50vw 40vh at 100% 10%, rgba(0,190,110,.15), transparent 60%),
      linear-gradient(180deg,var(--bg2),var(--bg1) 35%, #010504);
    overflow-x:hidden;
  }
  #bgCanvas{position:fixed; inset:0; z-index:-1}
  .screen{max-width:880px; margin:32px auto 120px; padding:0 18px}
  .head{display:flex; align-items:center; gap:14px; margin-bottom:14px}
  .avatar{width:74px;height:74px;padding:3px;border-radius:22px;
    background:conic-gradient(from 0deg,var(--g1),var(--g2),var(--g3),var(--g1));
    box-shadow:0 18px 40px rgba(0,255,136,.25)}
  .avatar .inner{width:100%;height:100%;border-radius:19px;background:#03110c;overflow:hidden}
  .avatar img{width:100%;height:100%;object-fit:cover;display:block}
  .brand-title{display:inline-block;font-weight:1000;letter-spacing:.6px;padding:10px 14px 8px;border-radius:14px;
    background:linear-gradient(180deg,var(--glass1),var(--glass2));border:1px solid var(--stroke);color:#caffea;
    box-shadow:0 12px 36px rgba(0,255,136,.18);text-shadow:0 0 20px rgba(0,255,136,.25)}
  .brand-sub{margin-top:6px; color:var(--muted); font-size:12.5px}
  .brand-sub .sep{opacity:.5; margin:0 6px}
  .card{position:relative;overflow:hidden;border-radius:var(--rad);
    background:
      linear-gradient(180deg,var(--glass1),var(--glass2)),
      radial-gradient(120% 100% at 0% 0%,rgba(0,255,136,.10),transparent 60%),
      linear-gradient(180deg,var(--panel2),var(--panel));
    border:1px solid var(--stroke);box-shadow:var(--shadow),inset 0 0 0 1px rgba(255,255,255,.04);
    padding:22px; margin-top:10px; transform-style:preserve-3d}
  .card h3{margin:6px 0; font-size:22px; letter-spacing:.4px}
  .sub{color:var(--muted); margin-bottom:14px}
  .field{display:flex; align-items:center; gap:10px; min-height:58px; padding:4px 8px 4px 14px;
    background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));
    border:1px solid rgba(0,255,136,.18); border-radius:16px; box-shadow:inset 0 0 0 1px rgba(255,255,255,.04)}
  .field input{flex:1;border:0;background:transparent;color:var(--ink);font-size:16px;outline:none}
  .field input::placeholder{color:#cfeede}
  .iconbtn{display:grid;place-items:center;width:36px;height:36px;border-radius:10px;border:0;cursor:pointer;
    background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));color:#fff;
    box-shadow:inset 0 0 0 1px rgba(0,255,136,.22)}
  .iconbtn[disabled]{opacity:.6;cursor:not-allowed}
  .eye{width:22px;height:22px}
  .metaRow{display:flex;gap:10px;align-items:center;margin-top:8px;flex-wrap:wrap}
  .caps{display:none;font-size:12.5px;color:var(--warn)} .caps.show{display:inline-flex;gap:6px}
  .meter{height:6px;border-radius:999px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.08);overflow:hidden;flex:1;min-width:160px}
  .mbar{height:100%;width:0%;background:linear-gradient(90deg,#ff6b6b,#ffd24d,var(--ok));box-shadow:0 0 14px rgba(0,255,136,.35)}
  .btn{margin-top:14px;width:100%;height:56px;border-radius:16px;border:0;cursor:pointer;
    font-weight:900;letter-spacing:.5px;color:#00140a;position:relative;overflow:hidden;
    background:linear-gradient(180deg,rgba(255,255,255,.12),rgba(255,255,255,.05)),linear-gradient(135deg,var(--g1),var(--g2));
    box-shadow:0 18px 44px rgba(0,255,136,.32),inset 0 0 0 1px rgba(255,255,255,.08)}
  .btn .bar{position:absolute;left:0;top:0;bottom:0;width:0%;background:rgba(255,255,255,.08)}
  .status{min-height:22px;margin-top:10px;color:var(--muted);font-size:13px}
  .glass{margin-top:18px;border-radius:18px;background:linear-gradient(180deg,rgba(0,255,136,.06),rgba(255,255,255,.02));border:1px solid rgba(0,255,136,.16);box-shadow:0 12px 28px rgba(0,0,0,.45);padding:14px 16px}
  .steps{color:#d6ffea}
  .legal{margin:18px 0 0;text-align:center;color:var(--muted);font-size:12.5px}
  .toasts{position:fixed;right:18px;bottom:18px;display:flex;flex-direction:column;gap:10px;z-index:10}
  .toast{min-width:260px;max-width:360px;padding:12px 14px;border-radius:16px;color:#eafff6;background:linear-gradient(180deg,#07130f,#06100d);
    border:1px solid rgba(0,255,136,.25);box-shadow:0 20px 44px rgba(0,0,0,.6),0 10px 30px rgba(0,255,136,.18)}
  .toast .row{display:flex;gap:10px;align-items:flex-start}
  .toast .ic{width:20px;height:20px;color:#00ffa2}
  .visually-hidden{position:absolute;left:-10000px;top:auto;width:1px;height:1px;overflow:hidden}
  noscript{display:block;max-width:880px;margin:16px auto;color:#ffb4b4;text-align:center}

  /* ==== Floating chat (shared tokens) ==== */
  .chat-fab{
    position:fixed;right:16px;bottom:18px;z-index:60;
    width:58px;height:58px;border-radius:50%;
    border:1px solid var(--stroke);background:
      radial-gradient(60% 60% at 30% 20%, rgba(0,255,136,.35), transparent 60%),
      linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02)),
      linear-gradient(180deg, #0a1e16, #082016);
    box-shadow:0 18px 44px rgba(0,0,0,.5), 0 0 24px rgba(0,255,136,.25);
    display:grid;place-items:center;cursor:pointer;user-select:none;
    transition:transform .18s ease, box-shadow .18s ease;backdrop-filter:blur(10px)
  }
  .chat-fab:hover{ transform:translateY(-1px); box-shadow:0 22px 56px rgba(0,0,0,.6), 0 0 30px rgba(0,255,136,.32) }
  .chat-fab svg{width:26px;height:26px;color:var(--ink)}

  .chat-panel{
    position:fixed;right:16px;bottom:88px;z-index:60; width:320px; max-width:calc(100vw - 28px);
    border-radius:18px; overflow:hidden; border:1px solid var(--stroke);
    background:
      linear-gradient(180deg, rgba(0,255,136,.08), rgba(255,255,255,.02)),
      linear-gradient(180deg, var(--panel2), var(--panel));
    box-shadow:0 24px 64px rgba(0,0,0,.6), inset 0 0 0 1px rgba(255,255,255,.04);
    transform:translateY(12px) scale(.98); opacity:0; pointer-events:none;
    transition:opacity .18s ease, transform .18s ease; backdrop-filter:blur(12px)
  }
  .chat-panel.show{ opacity:1; transform:translateY(0) scale(1); pointer-events:auto }
  .chat-head{display:flex;align-items:center;gap:10px;padding:10px 12px;border-bottom:1px solid rgba(0,255,136,.15);
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02))}
  .chat-head .dot{width:8px;height:8px;border-radius:50%;background:var(--g1);box-shadow:0 0 12px rgba(0,255,136,.8)}
  .chat-head .t{font-weight:900;letter-spacing:.4px}
  .chat-head .xbtn{margin-left:auto;background:transparent;border:0;color:var(--ink);width:30px;height:30px;border-radius:10px;cursor:pointer;
    box-shadow:inset 0 0 0 1px rgba(0,255,136,.22)}
  .chat-body{max-height:360px;overflow:auto;padding:12px}
  .msg{display:flex;gap:10px;margin:8px 0}
  .msg .b{padding:10px 12px;border-radius:12px;max-width:80%;line-height:1.45;font-size:14px}
  .msg.you{justify-content:flex-end}
  .msg.you .b{background:#0e2a1f;border:1px solid rgba(0,255,136,.22)}
  .msg.bot .b{background:#0a1f17;border:1px solid rgba(0,255,136,.16);color:#d8fff0}
  .chat-quick{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px}
  .chip{padding:8px 10px;border-radius:999px;border:1px dashed rgba(0,255,136,.3);background:#081a14;color:#caffea;font-weight:700;cursor:pointer}
  .cta{display:flex;gap:8px;margin-top:12px}
  .cta a,.cta button{flex:1;text-align:center;padding:12px 10px;border-radius:12px;font-weight:1000;border:1px solid rgba(0,255,136,.25);
    background:linear-gradient(135deg, rgba(0,255,136,.18), rgba(0,210,120,.14));color:#00150c;cursor:pointer;text-decoration:none}
  .cta .sec{background:linear-gradient(180deg,#0a1a14,#071610); color:#eafff6}
  .chat-foot{display:flex;gap:8px;padding:10px;border-top:1px solid rgba(0,255,136,.15)}
  .chat-foot input{flex:1;border:1px solid rgba(0,255,136,.22);border-radius:12px;background:rgba(255,255,255,.04);
    color:var(--ink);padding:10px 12px;outline:none}
  .chat-foot button{border-radius:12px;border:1px solid rgba(0,255,136,.22);background:linear-gradient(180deg,#0a1a14,#071610);color:#eafff6;padding:10px 12px;font-weight:900;cursor:pointer}
</style>
</head>
<body>
<canvas id="bgCanvas" aria-hidden="true" width="375" height="641"></canvas>

<noscript>Trang này cần JavaScript để hoạt động. Vui lòng bật JavaScript.</noscript>

<main class="screen" role="main">
  <header class="head">
    <div class="avatar" aria-hidden="true"><div class="inner">
      <img alt="Avatar" src="https://i.postimg.cc/XvT3fFHQ/85-C54337-9753-4-BFB-BF71-57-E7527-F4775.png" loading="lazy">
    </div></div>
    <div>
      <div class="brand-title" aria-label="AKATSUKI IPA TEAM">AKATSUKI IPA TEAM</div>
      <div class="brand-sub">Tốc độ <span class="sep">•</span> An toàn <span class="sep">•</span> Ổn định</div>
    </div>
  </header>

  <section class="card" aria-labelledby="loginTitle" style="">
    <h3 id="loginTitle">Đăng nhập key</h3>
    <div class="sub" id="loginDesc">Nhập key đã được cấp để tiếp tục</div>

    <div class="field" role="group" aria-labelledby="loginTitle" aria-describedby="loginDesc">
      <label for="keyInput" class="visually-hidden">Key truy cập</label>
      <input id="keyInput" type="password" placeholder="Nhập key của bạn..." autocomplete="one-time-code" inputmode="text">
      <button class="iconbtn" id="btnPaste" type="button" title="Dán từ clipboard" aria-label="Dán từ clipboard">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="#eafff6" aria-hidden="true"><path d="M19 21H5a2 2 0 0 1-2-2V7h4V5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2h4v12a2 2 0 0 1-2 2zM9 5v2h6V5H9z"></path></svg>
      </button>
      <button class="iconbtn" id="toggleEye" type="button" title="Hiện/ẩn" aria-label="Hiện hoặc ẩn key">
        <svg class="eye" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12Z" stroke="currentColor" stroke-width="1.6"></path><circle cx="12" cy="12" r="3.2" stroke="currentColor" stroke-width="1.6"></circle></svg>
      </button>
    </div>

    <div class="metaRow">
      <span id="capsHint" class="caps" role="status" aria-live="polite">⚠️ Caps Lock đang bật</span>
      <div class="meter" aria-hidden="true"><div class="mbar" id="mbar"></div></div>
    </div>

    <button class="btn" id="loginBtn" type="button"><span id="btnTxt">Đăng nhập</span><div class="bar" id="btnBar"></div></button>
    <div class="status" role="status" aria-live="polite"><span id="statusText"></span></div>
  </section>

  <section class="glass" aria-labelledby="noteTitle">
    <h4 id="noteTitle">Ghi chú</h4>
    <div class="steps">
      Không chia sẻ key. Hệ thống sẽ khoá khi phát hiện sử dụng bất thường hoặc phát tán công khai.<br>
      • <b> Chạm giữ vào ô nhập để dán key từ clipboard. </b>
    </div>
  </section>

  <div class="legal">Bằng việc đăng nhập bạn đồng ý với <b>Điều khoản</b> &amp; <b>Chính sách bảo mật</b>.</div>
</main>

<div class="toasts" aria-live="polite" aria-atomic="true"></div>

<!-- Tùy chọn: nạp danh sách key nếu bạn có file riêng -->
<script src="keys.js" defer=""></script>

<script>
(function(){
  "use strict";

  const ZALO_URL = "https://zalo.me/0394615632";

  /* ===== DOM refs ===== */
  const $ = s => document.querySelector(s);
  const bg = $('#bgCanvas');
  const toastBox = $('.toasts');
  const keyInput = $('#keyInput');
  const loginBtn = $('#loginBtn');
  const btnBar = $('#btnBar');
  const statusText = $('#statusText');
  const mbar = $('#mbar');
  const capsHint = $('#capsHint');
  const toggleEye = $('#toggleEye');

  /* ===== Toast + helpers ===== */
  function toast(msg){
    const el=document.createElement('div');
    el.className='toast';
    el.innerHTML =
      '<div class="row"><svg class="ic" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><circle cx="12" cy="12" r="10"/></svg><div>'+String(msg)+'</div></div>';
    toastBox.appendChild(el);
    setTimeout(()=> el.remove(), 2800);
  }
  function vibrate(ms){ try{ if(navigator.vibrate) navigator.vibrate(ms||30); }catch{} }

  const safeStorage = {
    get l(){ try{return window.localStorage}catch{return null} },
    get s(){ try{return window.sessionStorage}catch{return null} },
    setItem(store,k,v){ try{ store?.setItem(k,v) }catch{} },
    getItem(store,k){ try{ return store?.getItem(k) }catch{ return null } }
  };

  /* ===== BG Dots ===== */
  (function initBg(){
    if(!bg) return;
    const bx = bg.getContext('2d');
    function rs(){ bg.width=innerWidth; bg.height=innerHeight }
    addEventListener('resize', rs, {passive:true}); rs();
    const dots = Array.from({length: 90}).map(()=>({
      x:Math.random()*bg.width,y:Math.random()*bg.height,r:Math.random()*1.8+.4,
      vx:(Math.random()*2-1)*.15,vy:(Math.random()*2-1)*.15,
      c:Math.random()<.5?'rgba(0,255,136,.75)':'rgba(0,210,120,.65)'
    }));
    (function draw(){
      bx.clearRect(0,0,bg.width,bg.height);
      for(const d of dots){
        d.x+=d.vx; d.y+=d.vy;
        if(d.x<0||d.x>bg.width) d.vx*=-1;
        if(d.y<0||d.y>bg.height) d.vy*=-1;
        bx.beginPath(); bx.arc(d.x,d.y,d.r,0,Math.PI*2); bx.fillStyle=d.c; bx.fill();
      }
      requestAnimationFrame(draw);
    })();
  })();

  /* ===== keys.js & hashing ===== */
  function getStore(){ return (window.UCHIHA_KEYS && typeof window.UCHIHA_KEYS==='object') ? window.UCHIHA_KEYS : {}; }
  async function sha256Hex(text){
    try{
      if(window.crypto && crypto.subtle){
        const enc=new TextEncoder().encode(text);
        const buf=await crypto.subtle.digest('SHA-256',enc);
        return [...new Uint8Array(buf)].map(b=>b.toString(16).padStart(2,'0')).join('');
      }
    }catch{}
    return '';
  }
  async function resolveKey(key){
    const store=getStore();
    if(store[key]) return {id:key, meta:store[key]};
    const digHex = await sha256Hex(key);
    if(digHex){
      const dig='sha256:'+digHex;
      if(store[dig]) return {id:dig, meta:store[dig]};
    }
    if(store.__DEMO_ALLOW__){
      return {id:'__demo__', meta:{ note:'DEMO', plan:{days:1} }};
    }
    return null;
  }
  function addMonths(date, m){ const d=new Date(date); const day=d.getDate(); d.setMonth(d.getMonth()+m); if(d.getDate()<day){ d.setDate(0); } return d; }
  function calcExpiry(meta, firstActivatedAt){
    if(meta?.exp) return new Date(meta.exp);
    if(meta?.plan?.days){ const base=new Date(firstActivatedAt); base.setDate(base.getDate()+Number(meta.plan.days||0)); return base; }
    if(meta?.plan?.months){ return addMonths(firstActivatedAt, Number(meta.plan.months||0)); }
    return new Date('9999-12-31T23:59:59Z');
  }

  /* ===== Strength + Caps ===== */
  function updateCapsHint(e){ const on = (e && typeof e.getModifierState==='function') ? e.getModifierState('CapsLock') : false; capsHint.classList.toggle('show', !!on); }
  keyInput.addEventListener('keydown', updateCapsHint, {passive:true});
  keyInput.addEventListener('keyup', updateCapsHint, {passive:true});
  keyInput.addEventListener('input', ()=>{
    const v=keyInput.value; const len=v.length;
    const variety=(/[a-z]/.test(v))+(/[A-Z]/.test(v))+(/[0-9]/.test(v))+(/[^A-Za-z0-9]/.test(v));
    mbar.style.width=Math.min(100, len*5+variety*15)+'%';
  }, {passive:true});

  /* ===== Paste + Eye ===== */
  $('#btnPaste').addEventListener('click', async ()=>{
    try{ if(!navigator.clipboard) throw new Error('Clipboard API không khả dụng');
      const t=await navigator.clipboard.readText(); keyInput.value=(t||'').trim();
      keyInput.dispatchEvent(new Event('input')); toast('Đã dán key');
    }catch{ toast('Clipboard bị chặn, hãy dán thủ công (Ctrl/⌘+V)'); }
  });
  function showKey(b){ keyInput.type=b?'text':'password'; }
  toggleEye.addEventListener('click', ()=> showKey(keyInput.type==='password'));

  /* ===== Progress bar helper ===== */
  function startProgress(){
    let p=0, stopped=false; btnBar.style.width='0%';
    function tick(){ if(stopped) return; p=Math.min(99,p+Math.random()*16+10); btnBar.style.width=p+'%'; if(p<99) requestAnimationFrame(tick); }
    requestAnimationFrame(tick); return ()=>{ stopped=true; btnBar.style.width='100%'; };
  }

  /* ===== menu.html check ===== */
  async function menuExists(){
    try{ const res = await fetch('menu.html', { method:'HEAD', cache:'no-store' }); return res.ok; }catch{ return false; }
  }

  /* ===== LOGIN ===== */
  let working=false;
  async function doLogin(){
    if(working) return;
    const key=(keyInput.value||'').trim();
    if(!key){ toast('Nhập key trước'); keyInput.focus(); vibrate(60); return; }

    working=true; loginBtn.setAttribute('disabled',''); statusText.textContent='Đang xác thực…';
    const stopProgress = startProgress();

    try{
      const hit = await resolveKey(key);
      if(!hit) throw new Error('Key không hợp lệ. Hãy nhập lại');

      const ACT_KEY='uchiha_activated_at_'+hit.id;
      let first = safeStorage.getItem(safeStorage.l, ACT_KEY);
      if(!first){ first = new Date().toISOString(); safeStorage.setItem(safeStorage.l, ACT_KEY, first); }

      const expDate = calcExpiry(hit.meta||{}, new Date(first));
      const exp = expDate?.getTime?.() || 0;
      if(exp && Date.now()>exp) throw new Error('Key đã hết hạn. Vui lòng gia hạn');

      // LƯU TOKEN VÀO CẢ 2 KHO
      safeStorage.setItem(safeStorage.s,'auth_token','1');
      safeStorage.setItem(safeStorage.l,'auth_token','1');
      safeStorage.setItem(safeStorage.l,'uchiha_key_expires', String(exp||0));
      if(hit.meta?.note) safeStorage.setItem(safeStorage.l,'uchiha_key_note', String(hit.meta.note));

      stopProgress(); statusText.textContent='Đăng nhập thành công! Đang kiểm tra trang…';
      const hasMenu = await menuExists();
      if(hasMenu){ statusText.textContent='Đang chuyển…'; setTimeout(()=> location.href='menu.html', 300); }
      else{ statusText.textContent='Đăng nhập xong. Chưa tìm thấy "menu.html".'; toast('Thiếu file menu.html — vẫn giữ phiên.'); }
    }catch(e){
      btnBar.style.width='0%'; statusText.textContent=e?.message||'Đăng nhập thất bại';
      keyInput.value=''; keyInput.focus(); keyInput.dispatchEvent(new Event('input'));
      vibrate(80); toast(statusText.textContent);
    }finally{
      working=false; loginBtn.removeAttribute('disabled');
    }
  }
  loginBtn.addEventListener('click', doLogin);
  keyInput.addEventListener('keydown', e=>{ if(e.key==='Enter') doLogin(); });

  /* ===== Auto restore ===== */
  (async function(){
    const ok = (safeStorage.getItem(safeStorage.s,'auth_token')==='1') || (safeStorage.getItem(safeStorage.l,'auth_token')==='1');
    const expMs = +(safeStorage.getItem(safeStorage.l,'uchiha_key_expires')||0);
    if(ok && (!expMs || Date.now()<expMs)){ if(await menuExists()) location.href='menu.html'; }
  })();

  /* Tilt nhẹ */
  (function(){ const card=document.querySelector('.card'); if(!card) return;
    card.addEventListener('pointermove', e=>{
      const r=card.getBoundingClientRect(), x=(e.clientX-(r.left+r.width/2))/(r.width/2), y=(e.clientY-(r.top+r.height/2))/(r.height/2);
      card.style.transform=`rotateY(${x*6}deg) rotateX(${-y*6}deg)`;
    },{passive:true}); card.addEventListener('pointerleave', ()=> card.style.transform=''); })();

  /* ===== Floating Chat: Mua key ===== */
  const chatFab = document.createElement('button');
  chatFab.className='chat-fab'; chatFab.title='Mua key'; chatFab.innerHTML='<svg viewBox="0 0 24 24" fill="none"><path d="M3 7h2l2 10h10l2-7H7" stroke="currentColor" stroke-width="1.6"/><circle cx="9" cy="19" r="1.4" fill="currentColor"/><circle cx="17" cy="19" r="1.4" fill="currentColor"/></svg>';
  document.body.appendChild(chatFab);

  const panel = document.createElement('section');
  panel.className='chat-panel';
  panel.innerHTML = `
    <div class="chat-head">
      <span class="dot" aria-hidden="true"></span>
      <span class="t">Mua key • Hỗ trợ</span>
      <button class="xbtn" aria-label="Đóng">&times;</button>
    </div>
    <div class="chat-body" id="chatBody">
      <div class="msg bot"><div class="b">ADMIN "Kay" 👋<br> </div></div>
      <div class="chat-quick" id="chatQuick">
        <span class="chip" data-t="Bảng giá">Bảng giá</span>
        <span class="chip" data-t="Cách kích hoạt">Cách kích hoạt</span>
        <span class="chip" data-t="Mua key ngay">Mua key ngay</span>
      </div>
      <div class="cta">
        <a href="${ZALO_URL}" target="_blank" rel="noopener" class="pri">Mua key ngay</a>
        <a href="${ZALO_URL}" target="_blank" rel="noopener" class="sec">Liên hệ Admin</a>
      </div>
    </div>
    <div class="chat-foot">
      <input id="chatInput" placeholder="Nhắn tin…">
      <button id="chatSend">Gửi</button>
    </div>`;
  document.body.appendChild(panel);

  function togglePanel(show){ panel.classList.toggle('show', show); }
  chatFab.addEventListener('click', ()=> togglePanel(!panel.classList.contains('show')));
  panel.querySelector('.xbtn').addEventListener('click', ()=> togglePanel(false));

  // Drag FAB
  (function enableDrag(){
    let sx=0, sy=0, ox=0, oy=0, dragging=false;
    const minX=8, minY=8;
    function pos(x,y){
      const vw = window.innerWidth, vh=window.innerHeight;
      const nx = Math.max(minX, Math.min(vw-66, x));
      const ny = Math.max(minY, Math.min(vh-66, y));
      chatFab.style.right = (vw - nx - 58) + 'px';
      chatFab.style.bottom = (vh - ny - 58) + 'px';
    }
    chatFab.addEventListener('pointerdown', e=>{
      dragging=true; sx=e.clientX; sy=e.clientY;
      const rect=chatFab.getBoundingClientRect(); ox=rect.left; oy=rect.top; chatFab.setPointerCapture(e.pointerId);
    });
    chatFab.addEventListener('pointermove', e=>{
      if(!dragging) return;
      pos(ox + (e.clientX - sx), oy + (e.clientY - sy));
    });
    chatFab.addEventListener('pointerup', e=>{
      if(!dragging) return; dragging=false; chatFab.releasePointerCapture(e.pointerId);
    });
  })();

  // Chat logic
  const chatBody = panel.querySelector('#chatBody');
  const chatInput = panel.querySelector('#chatInput');
  const chatSend = panel.querySelector('#chatSend');
  function addMsg(role, text){
    const item=document.createElement('div'); item.className='msg '+role;
    item.innerHTML = `<div class="b">${text}</div>`; chatBody.appendChild(item);
    chatBody.scrollTop = chatBody.scrollHeight;
  }
  function botReply(t){
    const map = {
      'bảng giá': '250K 1 OBB , 500K Vĩnh Viễn Nhấn "Mua key ngay"',
      'cách kích hoạt': 'Sau khi có key, nhập ở trang đăng nhập → Đăng nhập. Hệ thống tự kiểm tra hạn còn/ hết',
      'mua key ngay': `Nhấn nút <b>Mua key ngay</b> bên dưới để mở Zalo: <a href="${ZALO_URL}" target="_blank" rel="noopener">https://zalo.me/0394615632</a>`
    };
    const k = t.trim().toLowerCase();
    addMsg('bot', map[k] || 'Mình đã nhận được tin nhắn. Bạn có thể bấm "Mua key ngay" hoặc nhắn nhu cầu cụ thể nhé !');
  }
  chatSend.addEventListener('click', ()=>{
    const t = (chatInput.value||'').trim(); if(!t) return;
    addMsg('you', t); chatInput.value=''; setTimeout(()=> botReply(t), 300);
  });
  chatInput.addEventListener('keydown', e=>{ if(e.key==='Enter'){ chatSend.click(); }});
  panel.querySelector('#chatQuick').addEventListener('click', e=>{
    const chip = e.target.closest('.chip'); if(!chip) return;
    const t = chip.dataset.t || chip.textContent; addMsg('you', t); setTimeout(()=> botReply(t), 250);
  });

})();
</script><button class="chat-fab" title="Mua key"><svg viewBox="0 0 24 24" fill="none"><path d="M3 7h2l2 10h10l2-7H7" stroke="currentColor" stroke-width="1.6"></path><circle cx="9" cy="19" r="1.4" fill="currentColor"></circle><circle cx="17" cy="19" r="1.4" fill="currentColor"></circle></svg></button><section class="chat-panel">
    <div class="chat-head">
      <span class="dot" aria-hidden="true"></span>
      <span class="t">Mua key • Hỗ trợ</span>
      <button class="xbtn" aria-label="Đóng">×</button>
    </div>
    <div class="chat-body" id="chatBody">
      <div class="msg bot"><div class="b">ADMIN "Kay" 👋<br> </div></div>
      <div class="chat-quick" id="chatQuick">
        <span class="chip" data-t="Bảng giá">Bảng giá</span>
        <span class="chip" data-t="Cách kích hoạt">Cách kích hoạt</span>
        <span class="chip" data-t="Mua key ngay">Mua key ngay</span>
      </div>
      <div class="cta">
        <a href="https://zalo.me/0394615632" target="_blank" rel="noopener" class="pri">Mua key ngay</a>
        <a href="https://zalo.me/0394615632" target="_blank" rel="noopener" class="sec">Liên hệ Admin</a>
      </div>
    </div>
    <div class="chat-foot">
      <input id="chatInput" placeholder="Nhắn tin…">
      <button id="chatSend">Gửi</button>
    </div></section>

</body></html>